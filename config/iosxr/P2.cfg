!
hostname P2
domain name croclab.ru
!
interface Loopback0
 ipv4 address 172.16.0.2/32
!
interface MgmtEth0/0/CPU0/0
 description "OOB to MGMT Network"
 ipv4 address 172.23.84.202 255.255.255.0
 no shutdown
!
interface Gi0/0/0/0.23
 description "P3"
 encapsulation dot1q 23
 ipv4 address 10.0.0.25/31
interface Gi0/0/0/0
 no shutdown
interface Gi0/0/0/0.222
 description "PE2"
 encapsulation dot1q 222
 ipv4 address 10.0.0.18/31
interface Gi0/0/0/0
 no shutdown
interface Gi0/0/0/0.12
 description "P1"
 encapsulation dot1q 12
 ipv4 address 10.0.0.21/31
interface Gi0/0/0/0
 no shutdown
interface Gi0/0/0/0.24
 description "P4"
 encapsulation dot1q 24
 ipv4 address 10.0.0.17/31
interface Gi0/0/0/0
 no shutdown
!
router static
 address-family ipv4 unicast
  0.0.0.0/0 172.23.84.1
 !
!
route-policy ISIS_LEAK
   if destination in (172.16.0.0/24 eq 32) then
     pass
   endif
end-policy
!
router isis 65000
net 49.0000.0000.0000.0002.00
is-type level-1-2
set-overload-bit on-startup wait-for-bgp
address-family ipv4 unicast
  metric-style wide
  ispf
  mpls traffic-eng level-2-only
  mpls traffic-eng router-id Loopback0
  propagate level 2 into level 1 route-policy ISIS_LEAK
interface Loopback0
  passive
  address-family ipv4 unicast
  circuit-type level-1-2
 interface Gi0/0/0/0.12
   point-to-point
   circuit-type level-1-2
  address-family ipv4 unicast
   metric 100
 interface Gi0/0/0/0.222
   point-to-point
   circuit-type level-1
  address-family ipv4 unicast
   metric 10
   mpls ldp sync
 interface Gi0/0/0/0.23
   point-to-point
   circuit-type level-2-only
  address-family ipv4 unicast
   metric 1000
 interface Gi0/0/0/0.24
   point-to-point
   circuit-type level-2-only
  address-family ipv4 unicast
   metric 10
!
mpls ldp
 session protection
 address-family ipv4
  label
   local
    allocate for host-routes
 no interface Gi0/0/0/0.12 
 interface Gi0/0/0/0.222
 no interface Gi0/0/0/0.23 
 no interface Gi0/0/0/0.24 
!
rsvp
 interface Gi0/0/0/0.12
 interface Gi0/0/0/0.23
 interface Gi0/0/0/0.24
!
mpls traffic-eng
reoptimize 30
 interface Gi0/0/0/0.12
 no interface Gi0/0/0/0.222
 interface Gi0/0/0/0.23
 interface Gi0/0/0/0.24
!
group GR-LSP
 interface 'tunnel-te.*'
  ipv4 unnumbered Loopback0
  autoroute announce
  record-route
  path-option 1 dynamic
end-group
!
interface tunnel-te1
 apply-group GR-LSP
 signalled-name P2-->P1
 destination 172.16.0.1
interface tunnel-te5
 apply-group GR-LSP
 signalled-name P2-->P5
 destination 172.16.0.5
interface tunnel-te6
 apply-group GR-LSP
 signalled-name P2-->P6
 destination 172.16.0.6
!
mpls oam
ssh server v2
ssh server logging
xml agent ssl
 iteration off
!
xml agent tty
 iteration off
!
netconf agent tty
!
end
!
